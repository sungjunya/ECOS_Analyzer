<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECOS ì¢…í•© ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="main-wrapper">
        <div class="main-content">
            <h1>ğŸ“Š ECOS ì¢…í•© ê²½ì œÂ·ë¶€ë™ì‚° ëŒ€ì‹œë³´ë“œ</h1>

            <div class="nav">
                <button id="btn-economy" class="active" onclick="switchTab('economy')">ê²½ì œ ì‹ í˜¸</button>
                <button id="btn-realestate" onclick="switchTab('realestate')">ë¶€ë™ì‚° ì‹ í˜¸</button>

                <button onclick="window.open('http://localhost:8501', '_blank')"
                    style="background: #e9940c; color: white; font-weight: 600;">
                    ğŸ“ˆ LSTM ì˜ˆì¸¡
                </button>
            </div>

            <div class="tabs">
                <div id="economy-tab">
                    <div class="period">
                        <button id="economy-btn-1y" class="active" onclick="setEconomyPeriod('1y')">1ë…„</button>
                        <button id="economy-btn-3y" onclick="setEconomyPeriod('3y')">3ë…„</button>
                        <button id="economy-btn-5y" onclick="setEconomyPeriod('5y')">5ë…„</button>
                    </div>

                    <div class="summary" id="summary">ë¡œë”© ì¤‘...</div>

                    <div id="overall-summary">
                        <div id="eco-risk-level" class="color-gray">ì „ì²´ ê²½ì œ ìš”ì•½ ë¡œë”© ì¤‘</div>
                        <div id="eco-description">ë¶„ì„ ì¤‘...</div>
                        <div id="eco-recommendation">íˆ¬ì ì „ëµ ë¡œë”© ì¤‘...</div>
                    </div>


                    <div class="chart-container">
                        <div class="chart-box" id="chart-box-composite">
                            <h3>ğŸ“ˆ ì¢…í•© íˆ¬ì ì‹ í˜¸ ì ìˆ˜</h3>
                            <canvas id="chart-composite"></canvas>
                        </div>

                        <div class="chart-box">
                            <h3>ê¸ˆë¦¬ ìŠ¤í”„ë ˆë“œ <span class="definition-icon" data-word="ê¸ˆë¦¬ ìŠ¤í”„ë ˆë“œ">â“˜</span></h3>
                            <canvas id="chart-spread"></canvas>
                        </div>

                        <div class="chart-box">
                            <h3>M2 ì¦ê°€ìœ¨ <span class="definition-icon" data-word="M2 (ê´‘ì˜í†µí™”)">â“˜</span></h3>
                            <canvas id="chart-m2"></canvas>
                        </div>

                        <div class="chart-box">
                            <h3>CPI <span class="definition-icon" data-word="ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜">â“˜</span></h3>
                            <canvas id="chart-cpi"></canvas>
                        </div>

                        <div class="chart-box">
                            <h3>PPI <span class="definition-icon" data-word="ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜">â“˜</span></h3>
                            <canvas id="chart-ppi"></canvas>
                        </div>
                    </div>
                </div>

                <div id="realestate-tab" style="display:none;">
                    <div class="period">
                        <button id="re-btn-1y" onclick="setREPeriod('1y')">1ë…„</button>
                        <button id="re-btn-3y" onclick="setREPeriod('3y')">3ë…„</button>
                        <button id="re-btn-5y" class="active" onclick="setREPeriod('5y')">5ë…„</button>
                    </div>

                    <div class="summary" id="re-summary">ë¶€ë™ì‚° ë°ì´í„° ë¡œë”© ì¤‘...</div>

                    <div id="re-box-summary">
                        <div id="re-risk-level" class="color-gray">ë¶€ë™ì‚° ê²½ê¸° ìœ„í—˜ ë“±ê¸‰ ë¡œë”© ì¤‘</div>
                        <div id="re-risk-description">ë¶„ì„ ì¤‘...</div>
                        <div id="re-risk-recommendation">íˆ¬ì ëŒ€ì‘ ì „ëµ ë¡œë”© ì¤‘...</div>
                    </div>

                    <div class="chart-container">
                        <div class="chart-box">
                            <h3>ğŸ  ì£¼íƒë§¤ë§¤ê°€ê²©ì§€ìˆ˜ (YoY) <span class="definition-icon" data-word="ì£¼íƒë§¤ë§¤ê°€ê²©ì§€ìˆ˜">â“˜</span></h3>
                            <canvas id="re-sale"></canvas>
                        </div>
                        <div class="chart-box">
                            <h3>ì „ì„¸ê°€ê²©ì§€ìˆ˜ (YoY) <span class="definition-icon" data-word="ì „ì„¸ê°€ê²©ì§€ìˆ˜">â“˜</span></h3>
                            <canvas id="re-rent"></canvas>
                        </div>
                        <div class="chart-box">
                            <h3>ê±´ì¶•í—ˆê°€ ì—°ë©´ì  (YoY) <span class="definition-icon" data-word="ê±´ì¶•í—ˆê°€ ì—°ë©´ì ">â“˜</span></h3>
                            <canvas id="re-permit"></canvas>
                        </div>
                        <div class="chart-box">
                            <h3>ê¸°ì¤€ê¸ˆë¦¬ <span class="definition-icon" data-word="ê¸°ì¤€ê¸ˆë¦¬">â“˜</span></h3>
                            <canvas id="re-rate"></canvas>
                        </div>
                        <div class="chart-box">
                            <h3>M2 ì¦ê°€ìœ¨ (YoY) <span class="definition-icon" data-word="M2 (ê´‘ì˜í†µí™”)">â“˜</span></h3>
                            <canvas id="re-m2"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="news-sidebar">
            <h2
                style="font-size: 1.2em; font-weight: 700; color: #1f2937; margin-bottom: 12px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">
                ğŸ“° ì‹¤ì‹œê°„ ë‰´ìŠ¤
            </h2>

            <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                <input type="text" id="news-search-input" placeholder="ë‰´ìŠ¤ ê²€ìƒ‰ì–´ (ì˜ˆ: ê¸ˆë¦¬ ì¸ìƒ)"
                    onkeypress="if(event.key === 'Enter') handleNewsSearch();">
                <button onclick="handleNewsSearch()" class="search-button">
                    ê²€ìƒ‰
                </button>
            </div>

            <div id="news-feed-container" class="space-y-3">
                <p style="color: #6b7280; text-align: center; padding: 10px;">ìµœì‹  ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
        </div>
    </div>

    <div id="definition-modal" style="display: none;">
        <div>
            <h3 id="modal-title"
                style="font-size: 1.2em; font-weight: 700; margin-bottom: 10px; border-bottom: 1px solid #e5e7eb; padding-bottom: 5px;">
            </h3>
            <div id="modal-definition">
            </div>
            <button onclick="document.getElementById('definition-modal').style.display='none';"
                style="margin-top: 15px; width: 100%; padding: 10px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                ë‹«ê¸°
            </button>
        </div>
    </div>


    <script>
        let currentTab = 'economy';
        let currentEconomyPeriod = '1y'; // ê²½ì œ íƒ­ ê¸°ê°„
        let currentREPeriod = '5y'; // ë¶€ë™ì‚° íƒ­ ê¸°ê°„ (ê¸°ë³¸ 5ë…„)
        const charts = {};

        function switchTab(tab) {
            currentTab = tab;
            document.getElementById('economy-tab').style.display = tab === 'economy' ? 'block' : 'none';
            document.getElementById('realestate-tab').style.display = tab === 'realestate' ? 'block' : 'none';
            document.getElementById('btn-economy').classList.toggle('active', tab === 'economy');
            document.getElementById('btn-realestate').classList.toggle('active', tab === 'realestate');
            if (tab === 'economy') loadEconomy();
            else loadRealEstate();
        }

        // ğŸ‘‡ ê²½ì œ íƒ­ ê¸°ê°„ ì„¤ì • í•¨ìˆ˜
        function setEconomyPeriod(period) {
            currentEconomyPeriod = period;
            ['1y', '3y', '5y'].forEach(p => {
                document.getElementById(`economy-btn-${p}`).classList.toggle('active', p === period);
            });
            loadEconomy();
        }

        // ğŸš€ ë¶€ë™ì‚° íƒ­ ê¸°ê°„ ì„¤ì • í•¨ìˆ˜
        function setREPeriod(period) {
            currentREPeriod = period;
            ['1y', '3y', '5y'].forEach(p => {
                document.getElementById(`re-btn-${p}`).classList.toggle('active', p === period);
            });
            loadRealEstate();
        }


        // ğŸŸ¢ ê²½ì œ ì‹ í˜¸ ë¡œë“œ
        async function loadEconomy() {
            document.getElementById('summary').innerText = 'ë°ì´í„° ë¡œë”© ì¤‘...';
            const res = await fetch(`/api/signal?period=${currentEconomyPeriod}`);
            const data = await res.json();

            if (!data.indicators) {
                document.getElementById('summary').innerText = `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
                return;
            }

            // ê²½ì œ ì‹ í˜¸ UI ì—…ë°ì´íŠ¸
            document.getElementById('summary').innerHTML =
                `ğŸ“… ${data.date} (${data.period}) | <span class="badge ${data.classification.color}">${data.classification.level}</span> ì¢…í•© ì ìˆ˜: <strong>${data.compositeScore}</strong>`;

            // ğŸš€ [ìˆ˜ì •] ê²½ì œ ì‹ í˜¸ ìš”ì•½ ë°•ìŠ¤ (ë¶€ë™ì‚°ê³¼ ë™ì¼í•œ êµ¬ì¡°ë¡œ ë³€ê²½)
            const colorClass = 'color-' + data.classification.color;
            document.getElementById('overall-summary').innerHTML = `
                <div id="eco-risk-level" class="${colorClass}">
                    ${data.classification.level} (${data.compositeScore}ì )
                </div>
                <div id="eco-description">
                    ${data.classification.description}
                </div>
                <div id="eco-recommendation">
                    âœ… íˆ¬ì ë°©í–¥ì„± ì¶”ì²œ: <strong>${data.classification.recommendation}</strong>
                </div>
            `;

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ìƒ‰ìƒ í†µì¼)
            updateChart('chart-composite', data.compositeScoreHistory, '#3b82f6', 'ì¢…í•© ì ìˆ˜', '%', data.classification.color);
            updateChart('chart-spread', data.indicators.spread.chartData, '#ef4444', 'ê¸ˆë¦¬ ìŠ¤í”„ë ˆë“œ', 'pp', data.classification.color);
            updateChart('chart-m2', data.indicators.m2.chartData, '#3b82f6', 'M2 ì¦ê°€ìœ¨', '%', data.classification.color);
            updateChart('chart-cpi', data.indicators.cpi.chartData, '#f59e0b', 'CPI ì¦ê°€ìœ¨', '%', data.classification.color);
            updateChart('chart-ppi', data.indicators.ppi.chartData, '#10b981', 'PPI ì¦ê°€ìœ¨', '%', data.classification.color);
        }

        // ğŸ  ë¶€ë™ì‚° ì‹ í˜¸ ë¡œë“œ
        async function loadRealEstate() {
            document.getElementById('re-summary').innerText = 'ë°ì´í„° ë¡œë”© ì¤‘...';
            const res = await fetch(`/api/realestate?period=${currentREPeriod}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('re-summary').innerText = `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${data.error}`;
                document.getElementById('re-risk-level').innerText = "ì—ëŸ¬ ë°œìƒ";
                document.getElementById('re-risk-level').className = 'color-red';
                return;
            }

            const risk = data.risk;
            const colorClass = 'color-' + risk.color;

            // ğŸš€ ë¶€ë™ì‚° ì‹ í˜¸ UI ì—…ë°ì´íŠ¸
            document.getElementById('re-summary').innerHTML =
                `ğŸ“… ${data.date} (${data.period}) | <span class="badge ${risk.color}">${risk.level.split(' ')[0].trim()}</span>`;

            // ğŸš€ [ìˆ˜ì •] #re-box-summaryì— = ì—°ì‚°ì ì‚¬ìš©í•˜ì—¬ ë‚´ìš© ë®ì–´ì“°ê¸° (ì¤‘ì²© ë²„ê·¸ í•´ê²°)
            document.getElementById('re-box-summary').innerHTML = `
                <div id="re-risk-level" class="${colorClass}">${risk.level}</div>
                <div id="re-risk-description">${risk.summary}</div>
                <div id="re-risk-recommendation">ğŸ‘‰ ${risk.recommendation}</div>
                <hr style="margin: 15px 0 10px 0; border: 0; border-top: 1px dashed #e5e7eb;">
                <div style="font-size: 0.9em; color: #4b5563;">
                    ${data.cycleTitle} : ${data.cycleMessage}
                </div>
            `;

            // ğŸš€ ì°¨íŠ¸ ë°ì´í„° ì—…ë°ì´íŠ¸ (YoY ì§€í‘œ ì‚¬ìš©)
            updateChart('re-sale', data.indicators.salePriceYoY.chartData, '#ef4444', 'ë§¤ë§¤ê°€ê²© YoY', '%', risk.color);
            updateChart('re-rent', data.indicators.rentPriceYoY.chartData, '#f59e0b', 'ì „ì„¸ê°€ê²© YoY', '%', risk.color);
            updateChart('re-permit', data.indicators.permitYoY.chartData, '#3b82f6', 'ê±´ì¶•í—ˆê°€ YoY', '%', risk.color);
            updateChart('re-rate', data.indicators.interestRate.chartData, '#10b981', 'ê¸°ì¤€ê¸ˆë¦¬', '%', risk.color);
            updateChart('re-m2', data.indicators.m2YoY.chartData, '#9051d9', 'M2 ì¦ê°€ìœ¨ YoY', '%', risk.color);

        }

        // ğŸš€ í†µí•© ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateChart(id, data, defaultColor, label = '', unit = '%', colorKey = 'gray') {
            if (!data || data.length === 0) {
                const container = document.getElementById(id).parentElement;
                if (container) {
                    container.innerHTML = `<div style="text-align: center; padding: 50px;">ë°ì´í„° ì—†ìŒ</div>`;
                }
                return;
            }

            const ctx = document.getElementById(id).getContext('2d');
            const labels = data.map(d => d.time.slice(0, 4) + '.' + d.time.slice(4));
            const values = data.map(d => d.value);

            // ì°¨íŠ¸ ë¼ì¸ ìƒ‰ìƒ ê²°ì • (ë¶€ë™ì‚° íƒ­ì€ ìœ„í—˜ ë“±ê¸‰ ìƒ‰ìƒ ì‚¬ìš©)
            let chartLineColor = defaultColor;
            if (id.startsWith('re-')) {
                switch (colorKey) {
                    case 'red': chartLineColor = '#ef4444'; break;
                    case 'orange': chartLineColor = '#f97316'; break;
                    case 'yellow': chartLineColor = '#f59e0b'; break;
                    case 'green': chartLineColor = '#10b981'; break;
                    case 'blue': chartLineColor = '#3b82f6'; break;
                    default: chartLineColor = defaultColor;
                }
            }


            if (charts[id]) charts[id].destroy();
            charts[id] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label,
                        data: values,
                        borderColor: chartLineColor,
                        backgroundColor: chartLineColor + '30',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { ticks: { maxTicksLimit: 6 } },
                        y: {
                            beginAtZero: false,
                            title: { display: true, text: unit }
                        }
                    }
                }
            });
        }

        // =========================================================================
        // 5. ğŸš€ ë‰´ìŠ¤ í”¼ë“œ í†µí•© ë° ê²€ìƒ‰ í•¨ìˆ˜ (ìš”ì•½ ì¶”ê°€)
        // =========================================================================
        const newsContainer = document.getElementById('news-feed-container');
        const newsSearchInput = document.getElementById('news-search-input');

        // ğŸš€ ì‹ ê·œ: ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜
        function handleNewsSearch() {
            const keyword = newsSearchInput.value.trim();
            if (keyword) {
                loadNews(keyword);
            } else {
                // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆì„ ê²½ìš° ê¸°ë³¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰
                loadNews('ê²½ì œ ë™í–¥');
            }
        }

        async function loadNews(keyword = 'ê²½ì œ ë™í–¥') { // ê¸°ë³¸ í‚¤ì›Œë“œ ì„¤ì •
            newsContainer.innerHTML = '<p style="color: #6b7280; text-align: center; padding: 10px; font-size: 0.9em;">' + keyword + ' ê´€ë ¨ ìµœì‹  ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>';

            // ê²€ìƒ‰ í‚¤ì›Œë“œë¥¼ í—¤ë”ì— ë°˜ì˜
            document.querySelector('.news-sidebar h2').innerHTML = `
                ğŸ“° ì‹¤ì‹œê°„ ë‰´ìŠ¤ (${keyword})
            `;

            try {
                // ì„œë²„ì˜ /api/news ë¼ìš°íŠ¸ í˜¸ì¶œ (server.jsì— ì´ ë¼ìš°íŠ¸ê°€ êµ¬í˜„ë˜ì–´ ìˆì–´ì•¼ í•¨)
                const response = await fetch(`/api/news?query=${encodeURIComponent(keyword)}`);
                const data = await response.json();

                if (data.success && data.news && data.news.length > 0) {
                    newsContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

                    data.news.forEach(item => {
                        const newsItem = document.createElement('div');
                        newsItem.className = 'news-item';

                        // ë„¤ì´ë²„ APIì˜ title/descriptionì€ HTML íƒœê·¸ë¥¼ í¬í•¨í•˜ë¯€ë¡œ, innerHTML ì‚¬ìš©
                        // ğŸ’¡ ìˆ˜ì •: ìš”ì•½(description)ì„ ì¶”ê°€
                        newsItem.innerHTML = `
                            <a href="${item.link}" target="_blank">${item.title}</a>
                            <p class="news-description">${item.description}</p>
                            <p style="font-size: 0.75em; color: #9ca3af; margin-top: 5px;">${new Date(item.pubDate).toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' })}</p>
                        `;
                        newsContainer.appendChild(newsItem);
                    });
                } else {
                    newsContainer.innerHTML = `<p style="color: #6b7280; text-align: center; padding: 10px; font-size: 0.9em;">'${keyword}'ì— ëŒ€í•œ ë‰´ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }

            } catch (error) {
                console.error('Error fetching news:', error);
                newsContainer.innerHTML = '<p style="color: #ef4444; text-align: center; padding: 10px; font-size: 0.9em;">ë‰´ìŠ¤ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.</p>';
            }
        }

        // =========================================================================
        // 6. ğŸš€ ECOS í†µê³„ ìš©ì–´ì‚¬ì „ í†µí•© í•¨ìˆ˜ (ëª¨ë‹¬ ì‚¬ìš©, ì •ì˜ ë‚´ì¥)
        // =========================================================================
        const modal = document.getElementById('definition-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDefinition = document.getElementById('modal-definition');

        // ğŸ’¡ ì‹ ê·œ: í•µì‹¬ ì§€í‘œ ìš©ì–´ ì •ì˜ë¥¼ ë‚´ì¥í•©ë‹ˆë‹¤.
        const definitionMap = {
            "ê¸ˆë¦¬ ìŠ¤í”„ë ˆë“œ": "ì¥ê¸° ê¸ˆë¦¬ì™€ ë‹¨ê¸° ê¸ˆë¦¬ì˜ ì°¨ì´ì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì¥ê¸° ê¸ˆë¦¬ê°€ ë‹¨ê¸°ë³´ë‹¤ ë†’ì§€ë§Œ, ê²½ê¸° ì¹¨ì²´ ìš°ë ¤ ì‹œ ì—­ì „(ì¥ê¸° < ë‹¨ê¸°)ë˜ë©° ë¶ˆí™©ì˜ ì‹ í˜¸ë¡œ í•´ì„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "M2 (ê´‘ì˜í†µí™”)": "í˜„ê¸ˆ, ìš”êµ¬ë¶ˆì˜ˆê¸ˆ, ìˆ˜ì‹œì…ì¶œê¸ˆì‹ ì˜ˆê¸ˆ ë“± ì¢ì€ ì˜ë¯¸ì˜ í†µí™”(M1)ì— 2ë…„ ë¯¸ë§Œ ì •ê¸° ì˜ˆì ê¸ˆ, ì‹œì¥í˜• ìƒí’ˆ ë“±ì„ í•©ì¹œ í†µí™”ëŸ‰ ì§€í‘œì…ë‹ˆë‹¤. ì‹œì¤‘ì˜ ìœ ë™ì„± ê·œëª¨ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.",
            "ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜": "CPI (Consumer Price Index)ëŠ” ë„ì‹œ ê°€êµ¬ê°€ ì†Œë¹„í•˜ëŠ” ìƒí’ˆê³¼ ì„œë¹„ìŠ¤ì˜ ê°€ê²© ë³€ë™ì„ ì¸¡ì •í•˜ëŠ” ì§€í‘œë¡œ, ì¼ë°˜ì ì¸ ì¸í”Œë ˆì´ì…˜ ìˆ˜ì¤€ì„ íŒŒì•…í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.",
            "ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜": "PPI (Producer Price Index)ëŠ” êµ­ë‚´ ìƒì‚°ìê°€ êµ­ë‚´ ì‹œì¥ì— ê³µê¸‰í•˜ëŠ” ìƒí’ˆê³¼ ì„œë¹„ìŠ¤ì˜ í‰ê·  ê°€ê²© ë³€ë™ì„ ì¸¡ì •í•©ë‹ˆë‹¤. CPIì˜ ì„ í–‰ ì§€í‘œë¡œ ê°„ì£¼ë˜ê¸°ë„ í•©ë‹ˆë‹¤.",
            "ì£¼íƒë§¤ë§¤ê°€ê²©ì§€ìˆ˜": "ì „êµ­ì˜ ì£¼íƒ ë§¤ë§¤ ê°€ê²© ë³€ë™ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œì…ë‹ˆë‹¤. ì „ë…„ ëŒ€ë¹„ ì¦ê°ë¥ (YoY)ì€ ë§¤ë§¤ ê°€ê²©ì˜ ë³€í™” ì†ë„ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.",
            "ì „ì„¸ê°€ê²©ì§€ìˆ˜": "ì „êµ­ì˜ ì£¼íƒ ì „ì„¸ ê°€ê²© ë³€ë™ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œì…ë‹ˆë‹¤. ì „ì„¸ ê°€ê²©ì€ ì‹¤ìˆ˜ìš”ì™€ ì£¼íƒ ì‹œì¥ì˜ ìˆ˜ê¸‰ ìƒí™©ì„ ë°˜ì˜í•©ë‹ˆë‹¤.",
            "ê±´ì¶•í—ˆê°€ ì—°ë©´ì ": "ë¯¸ë˜ ê±´ì„¤ ê²½ê¸°ë¥¼ ì˜ˆì¸¡í•˜ëŠ” ì„ í–‰ ì§€í‘œì…ë‹ˆë‹¤. ê±´ì¶• í—ˆê°€ë¥¼ ë°›ì€ ê±´ë¬¼ì˜ ì „ì²´ ì—°ë©´ì ìœ¼ë¡œ, í–¥í›„ ì£¼íƒ ê³µê¸‰ ë¬¼ëŸ‰ì„ ê°€ëŠ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
            "ê¸°ì¤€ê¸ˆë¦¬": "í•œêµ­ì€í–‰ ê¸ˆìœµí†µí™”ìœ„ì›íšŒì—ì„œ ê²°ì •í•˜ëŠ” ê¸ˆë¦¬ë¡œ, ê¸ˆìœµê¸°ê´€ ê°„ì˜ ê±°ë˜ ê¸°ì¤€ì´ ë˜ë©° ì‹œì¤‘ ê¸ˆë¦¬ ë° í†µí™” ì •ì±…ì˜ ê·¼ê°„ì´ ë©ë‹ˆë‹¤."
        };

        async function showDefinition(word) {
            modalTitle.textContent = `[${word}] ì •ì˜`;
            modalDefinition.innerHTML = '<p style="text-align: center; padding: 15px;">ìš©ì–´ ì„¤ëª…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            modal.style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ

            // ğŸ’¡ 1. ë‚´ì¥ëœ ì •ì˜ ë§µì—ì„œ ë¨¼ì € ì°¾ìŠµë‹ˆë‹¤.
            if (definitionMap[word]) {
                const cleanDefinition = definitionMap[word].replace(/\n/g, '<br>');
                modalDefinition.innerHTML = cleanDefinition;
                return; // ë‚´ì¥ëœ ì •ì˜ë¥¼ ì°¾ì•˜ìœ¼ë¯€ë¡œ API í˜¸ì¶œì„ ê±´ë„ˆë›°ê³  ëª¨ë‹¬ì„ í‘œì‹œ
            }

            // 2. ë‚´ì¥ëœ ì •ì˜ê°€ ì—†ì„ ê²½ìš° API í˜¸ì¶œ (í´ë°±)
            try {
                const response = await fetch(`/api/definition?word=${encodeURIComponent(word)}`);
                const data = await response.json();

                if (data.success) {
                    const cleanDefinition = data.definition.replace(/\n/g, '<br>');
                    modalDefinition.innerHTML = cleanDefinition;
                } else {
                    if (data.definition.includes('ìš©ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤') || !data.definition) {
                        modalDefinition.innerHTML = `<p style="text-align: center; padding: 15px; color: #f97316;">
                            [${word}]ì— ëŒ€í•œ ì •í™•í•œ ìš©ì–´ì‚¬ì „ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
                            ë‹¤ë¥¸ ìš©ì–´ë¡œ ê²€ìƒ‰í•´ ë³´ê±°ë‚˜, ì •ì˜ê°€ ì—†ëŠ” ìš©ì–´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </p>`;
                    } else {
                        modalDefinition.innerHTML = `<p style="color: #ef4444; text-align: center; padding: 15px;">${data.error || data.definition}</p>`;
                    }
                }
            } catch (error) {
                console.error('Error fetching definition:', error);
                modalDefinition.innerHTML = '<p style="color: #ef4444; text-align: center; padding: 15px;">ìš©ì–´ì‚¬ì „ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ.</p>';
            }
        }

        // â“˜ ì•„ì´ì½˜ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ document ì „ì²´ì— ì„¤ì • (Delegate pattern)
        document.addEventListener('click', (event) => {
            const icon = event.target.closest('.definition-icon');
            if (icon) {
                const word = icon.dataset.word;
                showDefinition(word);
            }
        });

        // =========================================================================
        // 7. ì´ˆê¸° ë¡œë“œ
        // =========================================================================
        loadEconomy();
        document.getElementById('re-btn-5y').classList.add('active');

        // ğŸš€ ì‹ ê·œ: ë‰´ìŠ¤ í”¼ë“œ ì´ˆê¸° ë¡œë“œ (ê¸°ë³¸ í‚¤ì›Œë“œë¡œ ì‹œì‘)
        loadNews('ê²½ì œ ë™í–¥'); 
    </script>
</body>

</html>