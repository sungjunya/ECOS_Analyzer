<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ECO'S</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="main-wrapper">
  <div class="main-content">
    <h1>ECO'S ì¢…í•© ê²½ì œÂ·ë¶€ë™ì‚° ëŒ€ì‹œë³´ë“œ</h1>

    <!-- ğŸ”˜ ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="nav">
      <button id="btn-economy" class="active" onclick="switchTab('economy')">ê²½ì œ ì‹ í˜¸</button>
      <button id="btn-realestate" onclick="switchTab('realestate')">ë¶€ë™ì‚° ì‹ í˜¸</button>
      <button onclick="window.open('http://localhost:8501', '_blank')" style="background:#007AFF;color:#fff;font-weight:600;">LSTM ì˜ˆì¸¡</button>
    </div>

    <!-- ğŸ“Š ê²½ì œ ì‹ í˜¸ -->
    <div id="economy-tab">
      <div class="period">
        <button id="economy-btn-1y" class="active" onclick="setEconomyPeriod('1y')">1ë…„</button>
        <button id="economy-btn-3y" onclick="setEconomyPeriod('3y')">3ë…„</button>
        <button id="economy-btn-5y" onclick="setEconomyPeriod('5y')">5ë…„</button>
      </div>

      <div class="summary" id="summary">
        ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>

      <div id="overall-summary">
        <div id="eco-risk-level" class="color-gray">ì „ì²´ ê²½ì œ ìš”ì•½ ë¡œë”© ì¤‘</div>
        <div id="eco-score" class="score-badge gray">-- ì </div>
        <div id="eco-description">ë¶„ì„ ì¤‘ ...</div>
        <div id="eco-recommendation">íˆ¬ì ì „ëµ ë¡œë”© ì¤‘ ...</div>
      </div>

      <!-- ğŸ“ˆ ì¢…í•© ì ìˆ˜ -->
      <div class="chart-box">
        <h3>ì¢…í•© íˆ¬ì ì ìˆ˜ 
          <span class="icard" data-tip="9ê°œ í•µì‹¬ ê²½ì œ ì§€í‘œë¥¼ ê°€ì¤‘ í‰ê· í•œ ì¢…í•© ì ìˆ˜ì…ë‹ˆë‹¤. ë‚®ì„ìˆ˜ë¡ ì–‘í˜¸í•œ ì‹œì¥ì„ ì˜ë¯¸í•©ë‹ˆë‹¤."></span>
        </h3>
        <canvas id="chart-composite"></canvas>
      </div>

      <!-- âš ï¸ ìœ„í—˜ë„ ì„¤ëª… -->
      <details class="legend-card">
        <summary>ìœ„í—˜ë„/ìƒ‰ìƒ ê²½ê³„ ì„¤ëª… 
          <span class="icard" data-tip="ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ìœ„í—˜, ë‚®ì„ìˆ˜ë¡ ì–‘í˜¸í•œ ì‹œì¥ì…ë‹ˆë‹¤."></span>
        </summary>
        <div class="legend-grid">
          <div class="legend-row"><span class="legend-dot red"></span><b>ìœ„í—˜(ë ˆë“œ)</b><span class="legend-text">ì¢…í•© ì ìˆ˜ â‰¥65. ìœ ë™ì„± ìœ„ì¶•, í˜„ê¸ˆ ë¹„ì¤‘ í™•ëŒ€.</span></div>
          <div class="legend-row"><span class="legend-dot orange"></span><b>ê²½ê³„(ì˜¤ë Œì§€)</b><span class="legend-text">50â€“64 êµ¬ê°„. ë³€ë™ì„± í™•ëŒ€, ë¶„í•  ì ‘ê·¼ ê¶Œì¥.</span></div>
          <div class="legend-row"><span class="legend-dot yellow"></span><b>ì£¼ì˜(ì˜ë¡œ)</b><span class="legend-text">35â€“49 êµ¬ê°„. ì¶”ì„¸ ì „í™˜ê¸°.</span></div>
          <div class="legend-row"><span class="legend-dot green"></span><b>ì–‘í˜¸(ê·¸ë¦°)</b><span class="legend-text">â‰¤34 êµ¬ê°„. ê²½ê¸° ê°œì„  ì¡°ì§.</span></div>
        </div>
      </details>

      <!-- ğŸ“Š ê²½ì œ ì‹ í˜¸ ê·¸ë˜í”„ 9ê°œ -->
      <div class="chart-container">
        <div class="chart-box"><h3>ê¸ˆë¦¬ ìŠ¤í”„ë ˆë“œ <span class="icard" data-tip="ë‹¨ê¸°Â·ì¥ê¸° ê¸ˆë¦¬ì°¨ì…ë‹ˆë‹¤. ì—­ì „ ì‹œ ê²½ê¸° ì¹¨ì²´ ì‹ í˜¸ë¡œ í•´ì„ë©ë‹ˆë‹¤."></span></h3><canvas id="chart-spread"></canvas></div>
        <div class="chart-box"><h3>M2 ì¦ê°€ìœ¨ <span class="icard" data-tip="í†µí™”ëŸ‰(M2) ì¦ê°€ìœ¨. ìœ ë™ì„± ì¶•ì†Œ ì‹œ ê²½ê¸° ë‘”í™” ê°€ëŠ¥ì„±ì´ ì»¤ì§‘ë‹ˆë‹¤."></span></h3><canvas id="chart-m2"></canvas></div>
        <div class="chart-box"><h3>CPI <span class="icard" data-tip="ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜ë¡œ, ì¸í”Œë ˆì´ì…˜ ìˆ˜ì¤€ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."></span></h3><canvas id="chart-cpi"></canvas></div>
        <div class="chart-box"><h3>PPI <span class="icard" data-tip="ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜. ê¸°ì—…ë‹¨ì˜ ë¬¼ê°€ ì••ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤."></span></h3><canvas id="chart-ppi"></canvas></div>
        <div class="chart-box"><h3>ì‹¤ì—…ë¥  <span class="icard" data-tip="ë…¸ë™ì‹œì¥ ìƒí™©ì„ ë°˜ì˜í•˜ë©°, ìƒìŠ¹ ì‹œ ê²½ê¸° ë‘”í™”ë¥¼ ì‹œì‚¬í•©ë‹ˆë‹¤."></span></h3><canvas id="chart-unemployment"></canvas></div>
        <div class="chart-box"><h3>CCSI <span class="icard" data-tip="ì†Œë¹„ìì‹¬ë¦¬ì§€ìˆ˜. 100 ì´ìƒì´ë©´ ë‚™ê´€, ë¯¸ë§Œì´ë©´ ë¹„ê´€ì„ ì˜ë¯¸í•©ë‹ˆë‹¤."></span></h3><canvas id="chart-ccsi"></canvas></div>
        <div class="chart-box"><h3>KOSPI <span class="icard" data-tip="êµ­ë‚´ ì£¼ì‹ì‹œì¥ ëŒ€í‘œì§€ìˆ˜ë¡œ, íˆ¬ìì‹¬ë¦¬ì™€ ê²½ê¸° ê¸°ëŒ€ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤."></span></h3><canvas id="chart-kospi"></canvas></div>
        <div class="chart-box"><h3>ë¬´ì—­ìˆ˜ì§€ <span class="icard" data-tip="ìˆ˜ì¶œì… ì°¨ì´ë¡œ, í‘ì ì‹œ ì™¸í™” ìœ ì…ì´ ì¦ê°€í•©ë‹ˆë‹¤."></span></h3><canvas id="chart-trade"></canvas></div>
        <div class="chart-box"><h3>í™˜ìœ¨ <span class="icard" data-tip="ì›/ë‹¬ëŸ¬ í™˜ìœ¨ì…ë‹ˆë‹¤. ìƒìŠ¹ ì‹œ ìˆ˜ì…ë¬¼ê°€ ìƒìŠ¹ ë° ì™¸êµ­ì¸ íˆ¬ì ê°ì†Œ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤."></span></h3><canvas id="chart-fx"></canvas></div>
      </div>
    </div>

    <!-- ğŸ  ë¶€ë™ì‚° ì‹ í˜¸ -->
    <div id="realestate-tab" style="display:none;">
      <div class="period">
        <button id="realestate-btn-1y" class="active" onclick="setRealestatePeriod('1y')">1ë…„</button>
        <button id="realestate-btn-3y" onclick="setRealestatePeriod('3y')">3ë…„</button>
        <button id="realestate-btn-5y" onclick="setRealestatePeriod('5y')">5ë…„</button>
      </div>

      <div class="summary" id="re-summary">
        ë¶€ë™ì‚° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<span class="dot"></span><span class="dot"></span><span class="dot"></span>
      </div>

      <div id="re-detail">
        <div id="re-risk-box" class="risk-box gray"><span class="kor">ë¡œë”© ì¤‘...</span></div>
        <div id="re-analysis">ë¶„ì„ ì¤‘...</div>
        <div id="re-recommendation">ì¶”ì²œ ì „ëµ ë¡œë”© ì¤‘ ...</div>
      </div>

      <details class="legend-card">
        <summary>ë¶€ë™ì‚° ìœ„í—˜ë„/ìƒ‰ìƒ ê²½ê³„ ì„¤ëª… 
          <span class="icard" data-tip="ë§¤ë§¤Â·ì „ì„¸, ê¸ˆë¦¬, ìœ ë™ì„± ë“± 5ê°œ ì£¼ìš” ì§€í‘œë¥¼ ì¢…í•©í•œ ë‹¨ê³„ì…ë‹ˆë‹¤."></span>
        </summary>
        <div class="legend-grid">
          <div class="legend-row"><span class="legend-dot red"></span><b>ìµœëŒ€ ìœ„í—˜</b><span class="legend-text">ê¸ˆë¦¬Â·ê³µê¸‰ ë™ì‹œ ìƒìŠ¹, ê¸‰ë½ ë° ìœ ë™ì„± ê²½ìƒ‰ ìœ„í—˜.</span></div>
          <div class="legend-row"><span class="legend-dot orange"></span><b>ê¸´ì¶• ê²½ê³„ </b><span class="legend-text">ê³¼ì—´ êµ­ë©´ì˜ ë‹¨ê¸° ì¡°ì • ê°€ëŠ¥ì„±.</span></div>
          <div class="legend-row"><span class="legend-dot yellow"></span><b>ì¹¨ì²´ íƒˆì¶œ</b><span class="legend-text">ì „ì„¸ ìƒìŠ¹, ë§¤ë§¤ í•˜ë½ ë‘”í™”, íšŒë³µ ì´ˆê¸°.</span></div>
          <div class="legend-row"><span class="legend-dot green"></span><b>í™•ì¥ ì´ˆê¸°</b><span class="legend-text">ë§¤ë§¤ ìƒìŠ¹ ì „í™˜, ê±°ë˜ íšŒë³µ êµ¬ê°„.</span></div>
          <div class="legend-row"><span class="legend-dot blue"></span><b>ì¹¨ì²´ê¸°</b><span class="legend-text">ë§¤ë§¤Â·ì „ì„¸ ëª¨ë‘ í•˜ë½ì„¸, ê±°ë˜ ìœ„ì¶•.</span></div>
        </div>
      </details>

      <!-- ğŸ  ë¶€ë™ì‚° ê·¸ë˜í”„ 5ê°œ -->
      <div class="chart-container">
        <div class="chart-box"><h3>ë§¤ë§¤ê°€ê²© YoY <span class="icard" data-tip="ì£¼íƒ ë§¤ë§¤ê°€ê²©ì˜ ì „ë…„ ëŒ€ë¹„ ìƒìŠ¹ë¥ ì…ë‹ˆë‹¤. ìƒìŠ¹ ì „í™˜ ì‹œ íšŒë³µ ì‹ í˜¸ë¡œ í•´ì„ë©ë‹ˆë‹¤."></span></h3><canvas id="chart-sale"></canvas></div>
        <div class="chart-box"><h3>ì „ì„¸ê°€ê²© YoY <span class="icard" data-tip="ì „ì„¸ê°€ê²©ì˜ ì „ë…„ ëŒ€ë¹„ ìƒìŠ¹ë¥ ì…ë‹ˆë‹¤. ë§¤ë§¤ì— ì„ í–‰í•˜ëŠ” íšŒë³µ ì§€í‘œì…ë‹ˆë‹¤."></span></h3><canvas id="chart-rent"></canvas></div>
        <div class="chart-box"><h3>ê±´ì¶•í—ˆê°€ë©´ì  YoY <span class="icard" data-tip="ê±´ì¶•í—ˆê°€ ì´ë©´ì ì˜ ì—°ê°„ ë³€í™”ìœ¨ë¡œ, í–¥í›„ ê³µê¸‰ ê¸°ëŒ€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."></span></h3><canvas id="chart-permit"></canvas></div>
        <div class="chart-box"><h3>ê¸°ì¤€ê¸ˆë¦¬ <span class="icard" data-tip="í•œêµ­ì€í–‰ ê¸°ì¤€ê¸ˆë¦¬. ì¸ìƒ ì‹œ ë¶€ë™ì‚° ìê¸ˆì¡°ë‹¬ ë¶€ë‹´ì´ ì»¤ì§‘ë‹ˆë‹¤."></span></h3><canvas id="chart-rate"></canvas></div>
        <div class="chart-box"><h3>M2 YoY <span class="icard" data-tip="í†µí™”ëŸ‰ ì¦ê°€ìœ¨ë¡œ, ë¶€ë™ì‚° ì‹œì¥ ë‚´ ìœ ë™ì„±ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."></span></h3><canvas id="chart-m2-re"></canvas></div>
      </div>
    </div>
  </div>

  <!-- ğŸ“° ë‰´ìŠ¤ ì˜ì—­ -->
  <div class="news-sidebar">
    <h2>ì‹¤ì‹œê°„ ë‰´ìŠ¤</h2>
    <div style="display:flex;gap:8px;margin-bottom:15px;">
      <input type="text" id="news-search-input" placeholder="ë‰´ìŠ¤ ê²€ìƒ‰ì–´ ì…ë ¥..." onkeypress="if(event.key==='Enter') handleNewsSearch();">
      <button onclick="handleNewsSearch()" class="search-button">ê²€ìƒ‰</button>
    </div>
    <div id="news-feed-container"><p style="color:#9ca3af;text-align:center;">ìµœì‹  ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p></div>
  </div>
</div>

<!-- ğŸ§¾ í‘¸í„° -->
<footer class="site-footer">
  <div class="footer-wrap">
    <div class="footer-left"><b>ECO'S Dashboard</b></div>
    <div class="footer-right">
      <span class="foot-note">
        ë³¸ ëŒ€ì‹œë³´ë“œëŠ” ã€Œí•œêµ­ì€í–‰ ECOSã€ ë“± ê³µê³µ ë°ì´í„° ë° ì™¸ë¶€ APIë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì •ë³´ ì‹œê°í™” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.<br>
        ì œê³µë˜ëŠ” ìë£Œì™€ ë¶„ì„ ê²°ê³¼ëŠ” ì¼ë°˜ì ì¸ ì°¸ê³ ìš© ì •ë³´ì¼ ë¿, ã€Œìë³¸ì‹œì¥ê³¼ ê¸ˆìœµíˆ¬ìì—…ì— ê´€í•œ ë²•ë¥ ã€ ìƒ íˆ¬ì ìë¬¸ì´ë‚˜ ê¶Œìœ ì— í•´ë‹¹í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        ë°ì´í„°ì—ëŠ” ì˜¤ë¥˜, ì§€ì—° ë˜ëŠ” ëˆ„ë½ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë©°, ì„œë¹„ìŠ¤ ì œê³µìëŠ” ê·¸ ì •í™•ì„±Â·ì™„ì „ì„±ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        ëª¨ë“  íˆ¬ì ê²°ì •ê³¼ ê·¸ ê²°ê³¼ì— ëŒ€í•œ ì±…ì„ì€ ì´ìš©ì ë³¸ì¸ì—ê²Œ ìˆìœ¼ë©°, ì„œë¹„ìŠ¤ ê°œë°œì ë° ìš´ì˜ìëŠ” ì´ì— ëŒ€í•´ ì–´ë– í•œ ë²•ì  ì±…ì„ë„ ë¶€ë‹´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
      </span>
    </div>
  </div>
</footer>

<!-- ğŸ“œ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
let currentEconomyPeriod='1y';
let currentRealestatePeriod='5y';
const charts={};

function switchTab(tab){
  document.getElementById('economy-tab').style.display=tab==='economy'?'block':'none';
  document.getElementById('realestate-tab').style.display=tab==='realestate'?'block':'none';
  document.getElementById('btn-economy').classList.toggle('active',tab==='economy');
  document.getElementById('btn-realestate').classList.toggle('active',tab==='realestate');
  if(tab==='economy')loadEconomy();else loadRealestate();
}

function setEconomyPeriod(p){
  currentEconomyPeriod=p;
  ['1y','3y','5y'].forEach(x=>document.getElementById(`economy-btn-${x}`).classList.toggle('active',x===p));
  loadEconomy();
}

async function loadEconomy(){
  const s=document.getElementById('summary'),o=document.getElementById('overall-summary');
  try{
    s.innerHTML=`ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
    o.style.opacity="0.5";
    const r=await fetch(`/api/signal?period=${currentEconomyPeriod}`);
    const d=await r.json();
    if(d.error)throw new Error(d.error);
    s.innerHTML=`${d.date} (${d.period})`;o.style.opacity="1";
    o.innerHTML=`<div id="eco-risk-level" class="color-${d.classification.color}">${d.classification.level}</div>
    <div id="eco-score" class="score-badge ${d.classification.color}">${d.compositeScore}ì </div>
    <div id="eco-description">${d.classification.description}</div>
    <div id="eco-recommendation"><strong>${d.classification.recommendation}</strong></div>`;
    for(const[k,v]of Object.entries(d.indicators)){
      updateChart('chart-'+k.replace('_yoy','').replace('_change',''),v.chartData);
    }
    updateChart('chart-composite',d.compositeScoreHistory);
  }catch(e){console.error(e);s.innerHTML=`âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨`;o.style.opacity="0.8";}
}

function setRealestatePeriod(p){
  currentRealestatePeriod=p;
  ['1y','3y','5y'].forEach(x=>document.getElementById(`realestate-btn-${x}`).classList.toggle('active',x===p));
  loadRealestate();
}

async function loadRealestate(){
  const s=document.getElementById('re-summary'),d=document.getElementById('re-detail');
  try{
    s.innerHTML=`ë¶€ë™ì‚° ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
    d.style.opacity="0.5";
    const r=await fetch(`/api/realestate?period=${currentRealestatePeriod}`);
    const j=await r.json();
    if(j.error)throw new Error(j.error);
    s.innerHTML=`${j.date} (${j.period})`;d.style.opacity="1";

    const box=document.getElementById('re-risk-box');
    const color=j.risk.color||'gray';
    const kor=j.risk.level||'ë°ì´í„° ì—†ìŒ';
    const eng=j.risk.levelEng||'';
    box.className=`risk-box ${color}`;
    box.innerHTML=`<span class="kor">${kor}</span>${eng?`<span class="eng">(${eng})</span>`:''}`;

    document.getElementById('re-analysis').innerText=j.risk.summary;
    document.getElementById('re-recommendation').innerText=j.risk.recommendation;

    const m={'chart-sale':j.indicators.salePriceYoY.chartData,'chart-rent':j.indicators.rentPriceYoY.chartData,'chart-permit':j.indicators.permitYoY.chartData,'chart-rate':j.indicators.interestRate.chartData,'chart-m2-re':j.indicators.m2YoY.chartData};
    for(const[id,arr]of Object.entries(m))updateChart(id,arr);
  }catch(e){s.innerHTML=`âš ï¸ ë¶€ë™ì‚° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨`;d.style.opacity="0.8";}
}

function updateChart(id,data){
  const el=document.getElementById(id);
  if(!el||!data?.length)return;
  const ctx=el.getContext('2d');
  const labels=data.map(d=>d.time);
  const values=data.map(d=>d.value);
  const diff=values[values.length-1]-values[0];
  let color='#8e8e93';
  if(diff>0.3)color='#ff3b30';
  else if(diff<-0.3)color='#0a84ff';
  if(charts[id])charts[id].destroy();
  charts[id]=new Chart(ctx,{
    type:'line',
    data:{labels,datasets:[{data:values,borderColor:color,backgroundColor:color+'30',fill:true,tension:0.35,borderWidth:2,pointRadius:2}]},
    options:{plugins:{legend:{display:false},tooltip:{enabled:true,mode:'nearest',intersect:false,callbacks:{label:(ctx)=>` ${ctx.parsed.y.toFixed(2)} `}}},
      scales:{x:{ticks:{color:'#a0a0a5'},grid:{color:'#2a2a2c'}},y:{ticks:{color:'#a0a0a5'},grid:{color:'#2a2a2c'}}}}
  });
}

async function loadNews(k='ê²½ì œ ë™í–¥'){
  const c=document.getElementById('news-feed-container');
  c.innerHTML=`'${k}' ë‰´ìŠ¤ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`;
  try{
    const r=await fetch(`/api/news?query=${encodeURIComponent(k)}`);
    const d=await r.json();
    if(d.success&&d.news?.length){
      c.innerHTML='';
      d.news.forEach(n=>c.innerHTML+=`<div class="news-item"><a href="${n.link}" target="_blank">${n.title}</a><p>${n.description}</p></div>`);
    }else c.innerHTML=`ë‰´ìŠ¤ ì—†ìŒ`;
  }catch{c.innerHTML=`ë¡œë“œ ì˜¤ë¥˜`;}
}
function handleNewsSearch(){const k=document.getElementById('news-search-input').value.trim()||'ê²½ì œ';loadNews(k);}
switchTab('economy');loadNews();
</script>
</body>
</html>
